<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Everfall - Global Leaderboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            color: white;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(168,85,247,0.2) 0%, rgba(168,85,247,0.05) 100%);
            border-radius: 20px;
            border: 2px solid rgba(168,85,247,0.3);
        }
        
        .header h1 {
            font-size: 48px;
            font-weight: 900;
            background: linear-gradient(90deg, #f59e0b 0%, #fbbf24 50%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 4px;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 18px;
            color: #94a3b8;
            font-weight: 600;
        }
        
        .refresh-info {
            text-align: center;
            color: #64748b;
            font-size: 14px;
            margin-bottom: 20px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 15px;
        }
        
        .tab {
            padding: 12px 24px;
            background: rgba(255,255,255,0.1);
            border: 2px solid transparent;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-size: 18px;
            font-weight: 700;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab:hover {
            background: rgba(255,255,255,0.15);
        }
        
        .tab.active {
            background: linear-gradient(135deg, #a855f7 0%, #8b5cf6 100%);
            border: 2px solid #a855f7;
            box-shadow: 0 5px 20px rgba(168,85,247,0.4);
        }
        
        .tab img {
            width: 24px;
            height: 24px;
            border-radius: 4px;
        }
        
        .leaderboard-container {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            border: 2px solid rgba(168,85,247,0.3);
        }
        
        .category-title {
            text-align: center;
            font-size: 36px;
            font-weight: 900;
            background: linear-gradient(90deg, #f59e0b 0%, #fbbf24 50%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 10px;
        }
        
        .top-players-text {
            text-align: center;
            font-size: 14px;
            color: #64748b;
            font-weight: 600;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        
        .server-cost-note {
            text-align: center;
            font-size: 11px;
            color: #475569;
            font-style: italic;
            margin-bottom: 25px;
        }
        
        .table-wrapper {
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.5);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead tr {
            background: linear-gradient(90deg, rgba(245,158,11,0.2) 0%, rgba(245,158,11,0.05) 100%);
            border-bottom: 2px solid rgba(245,158,11,0.5);
        }
        
        th {
            padding: 20px;
            text-align: left;
            font-size: 14px;
            font-weight: 700;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        th:last-child {
            text-align: right;
        }
        
        tbody tr {
            background: rgba(255,255,255,0.02);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s;
        }
        
        tbody tr:hover {
            background: rgba(255,255,255,0.05);
        }
        
        tbody tr.top1 {
            background: linear-gradient(90deg, rgba(251,191,36,0.15) 0%, rgba(251,191,36,0.05) 100%);
            box-shadow: inset 0 0 20px rgba(251,191,36,0.1);
        }
        
        tbody tr.top2 {
            background: linear-gradient(90deg, rgba(203,213,225,0.15) 0%, rgba(203,213,225,0.05) 100%);
            box-shadow: inset 0 0 20px rgba(203,213,225,0.1);
        }
        
        tbody tr.top3 {
            background: linear-gradient(90deg, rgba(205,127,50,0.15) 0%, rgba(205,127,50,0.05) 100%);
            box-shadow: inset 0 0 20px rgba(205,127,50,0.1);
        }
        
        td {
            padding: 20px;
            font-size: 16px;
            font-weight: 600;
            color: #e2e8f0;
        }
        
        td:last-child {
            text-align: right;
            font-size: 18px;
            font-weight: 900;
            color: #f59e0b;
            text-shadow: 0 2px 10px rgba(245,158,11,0.3);
        }
        
        .rank-cell {
            font-size: 24px;
            font-weight: bold;
        }
        
        .rank-cell.gold { color: #fbbf24; }
        .rank-cell.silver { color: #cbd5e1; }
        .rank-cell.bronze { color: #cd7f32; }
        .rank-cell.normal { color: #64748b; font-size: 16px; }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 30px;
        }
        
        .pagination button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #a855f7 0%, #8b5cf6 100%);
            border: 2px solid #a855f7;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(168,85,247,0.3);
        }
        
        .pagination button:hover:not(:disabled) {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(168,85,247,0.4);
        }
        
        .pagination button:disabled {
            background: rgba(100,116,139,0.3);
            border-color: rgba(100,116,139,0.3);
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .pagination span {
            font-size: 16px;
            color: #94a3b8;
            font-weight: 600;
        }
        
        .loading {
            text-align: center;
            padding: 60px;
            font-size: 24px;
            color: #64748b;
        }
        
        .error {
            text-align: center;
            padding: 40px;
            color: #ef4444;
            font-size: 18px;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 32px;
            }
            
            .tabs {
                gap: 5px;
                padding: 10px;
            }
            
            .tab {
                padding: 10px 16px;
                font-size: 16px;
            }
            
            .leaderboard-container {
                padding: 20px;
            }
            
            table {
                font-size: 14px;
            }
            
            th, td {
                padding: 12px 10px;
            }
            
            .pagination button {
                padding: 10px 16px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>EVERFALL LEADERBOARD</h1>
            <p>Global Rankings ‚Ä¢ Live Stats</p>
        </div>
        
        <div class="refresh-info">
            Auto-refreshes every 30 minutes ‚Ä¢ Next refresh: <span id="next-refresh">--:--</span>
        </div>
        
        <div class="tabs">
            <button class="tab active" data-category="gearScore" onclick="switchCategory('gearScore')">
                <span>‚öîÔ∏è</span> Gear Score
            </button>
            <button class="tab" data-category="highestFloor" onclick="switchCategory('highestFloor')">
                <span>üèÜ</span> Highest Floor
            </button>
            <button class="tab" data-category="petsFound" onclick="switchCategory('petsFound')">
                <span>üêæ</span> Pets Found
            </button>
            <button class="tab" data-category="mythicsFound" onclick="switchCategory('mythicsFound')">
                <span>‚ú®</span> Mythics Found
            </button>
            <button class="tab" data-category="runeTrialKills" onclick="switchCategory('runeTrialKills')">
                <img src="https://raw.githubusercontent.com/Graphic37/RPG-Dungeon-Simulator/main/blue_key_64_transparent.png" alt="Rune Trial"> Rune Trial
            </button>
            <button class="tab" data-category="vaultKills" onclick="switchCategory('vaultKills')">
                <img src="https://raw.githubusercontent.com/Graphic37/RPG-Dungeon-Simulator/main/gold_key_64_transparent.png" alt="Vault"> Vault
            </button>
        </div>
        
        <div class="leaderboard-container" id="leaderboard">
            <div class="loading">Loading leaderboard...</div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCkFY_gTrV8YoYrdslWUdNuP9iyeyO9NYw",
            authDomain: "everfall-59970.firebaseapp.com",
            projectId: "everfall-59970",
            storageBucket: "everfall-59970.firebasestorage.app",
            messagingSenderId: "711362553851",
            appId: "1:711362553851:web:2e815fd99263e4ff414d5e"
        };

        // Initialize Firebase
        let db = null;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            console.log('‚úÖ Firebase connected');
        } catch (error) {
            console.error('‚ùå Firebase error:', error);
            document.getElementById('leaderboard').innerHTML = '<div class="error">Failed to connect to Firebase. Please refresh the page.</div>';
        }

        let currentCategory = 'gearScore';
        let currentPage = 1;
        const PLAYERS_PER_PAGE = 25;
        const MAX_PAGES = 4; // 4 pages √ó 25 = 100 players max

        const categoryConfig = {
            gearScore: { title: 'TOP GEAR SCORES' },
            highestFloor: { title: 'HIGHEST FLOORS' },
            petsFound: { title: 'MOST PETS FOUND' },
            mythicsFound: { title: 'MOST MYTHICS FOUND' },
            runeTrialKills: { title: 'RUNE TRIAL BOSS KILLS' },
            vaultKills: { title: 'VAULT BOSS KILLS' }
        };

        let allPlayers = [];

        async function loadAllPlayers(category) {
            if (!db) return;

            try {
                const snapshot = await db.collection('leaderboard')
                    .orderBy(category, 'desc')
                    .limit(100)
                    .get();

                allPlayers = [];
                snapshot.forEach((doc) => {
                    allPlayers.push(doc.data());
                });

                currentPage = 1;
                displayPage();

            } catch (error) {
                console.error('Error loading leaderboard:', error);
                document.getElementById('leaderboard').innerHTML = '<div class="error">Error loading leaderboard. Please try again.</div>';
            }
        }

        function displayPage() {
            const container = document.getElementById('leaderboard');
            const config = categoryConfig[currentCategory];
            
            const startIndex = (currentPage - 1) * PLAYERS_PER_PAGE;
            const endIndex = Math.min(startIndex + PLAYERS_PER_PAGE, allPlayers.length);
            const pageData = allPlayers.slice(startIndex, endIndex);

            let html = `
                <div class="category-title">${config.title}</div>
                <div class="top-players-text">TOP 100 PLAYERS</div>
                <div class="server-cost-note">Only top 100 shown to minimize server costs</div>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Player</th>
                                <th>Score</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            pageData.forEach((data, index) => {
                const rank = startIndex + index + 1;
                const score = data[currentCategory] || 0;
                
                let rankEmoji = '';
                let rankClass = 'normal';
                let rowClass = '';
                
                if (rank === 1) {
                    rankEmoji = 'ü•á';
                    rankClass = 'gold';
                    rowClass = 'top1';
                } else if (rank === 2) {
                    rankEmoji = 'ü•à';
                    rankClass = 'silver';
                    rowClass = 'top2';
                } else if (rank === 3) {
                    rankEmoji = 'ü•â';
                    rankClass = 'bronze';
                    rowClass = 'top3';
                } else {
                    rankEmoji = `#${rank}`;
                }

                html += `
                    <tr class="${rowClass}">
                        <td class="rank-cell ${rankClass}">${rankEmoji}</td>
                        <td>${data.name}</td>
                        <td>${score.toLocaleString()}</td>
                    </tr>
                `;
            });

            html += `
                        </tbody>
                    </table>
                </div>
                <div class="pagination">
                    <button onclick="previousPage()" ${currentPage === 1 ? 'disabled' : ''}>‚Üê Previous</button>
                    <span>Page ${currentPage} of ${MAX_PAGES}</span>
                    <button onclick="nextPage()" ${currentPage >= MAX_PAGES || endIndex >= allPlayers.length ? 'disabled' : ''}>Next ‚Üí</button>
                </div>
            `;

            container.innerHTML = html;
        }

        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                displayPage();
            }
        }

        function nextPage() {
            if (currentPage < MAX_PAGES && (currentPage * PLAYERS_PER_PAGE) < allPlayers.length) {
                currentPage++;
                displayPage();
            }
        }

        function switchCategory(category) {
            currentCategory = category;
            
            // Update active tab
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-category="${category}"]`).classList.add('active');
            
            // Load leaderboard
            document.getElementById('leaderboard').innerHTML = '<div class="loading">Loading...</div>';
            loadAllPlayers(category);
        }

        function updateRefreshTimer() {
            const now = Date.now();
            const nextRefresh = Math.ceil(now / (30 * 60 * 1000)) * (30 * 60 * 1000);
            const timeUntil = nextRefresh - now;
            
            const minutes = Math.floor(timeUntil / 60000);
            const seconds = Math.floor((timeUntil % 60000) / 1000);
            
            document.getElementById('next-refresh').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function startAutoRefresh() {
            // Update timer every second
            setInterval(updateRefreshTimer, 1000);
            updateRefreshTimer();
            
            // Refresh leaderboard every 30 minutes
            setInterval(() => {
                console.log('Auto-refreshing leaderboard...');
                loadAllPlayers(currentCategory);
            }, 30 * 60 * 1000);
        }

        // Initial load
        loadAllPlayers(currentCategory);
        startAutoRefresh();
    </script>
</body>
</html>